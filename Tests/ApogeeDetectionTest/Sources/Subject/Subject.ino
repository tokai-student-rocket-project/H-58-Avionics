#include <Arduino.h>
#include "Trajectory.hpp"


Trajectory trajectory(0.25, 0.75);

float altitudes[] = { 9.93, 10.64, 8.57, 8.72, 8.79, 8.29, 9.79, 10.79, 13.07, 14.35, 14.92, 16.42, 18.92, 19.42, 22.21, 24.06, 26.28, 28.78, 31.71, 34.57, 38.43, 41.15, 42.94, 46.94, 48.73, 52.6, 54.96, 57.33, 59.62, 64.64, 67.22, 73.24, 78.55, 81.35, 84.01, 89.76, 93.93, 98.67, 102.56, 107.59, 111.41, 114.8, 117.68, 121.79, 127.34, 131.88, 136.07, 140.47, 143.94, 150.22, 153.19, 156.58, 162.95, 166.13, 168.81, 173.59, 175.69, 180.4, 185.18, 188.3, 192.58, 195.48, 198.75, 201.51, 206.67, 209.14, 213.35, 215.61, 219.47, 222.66, 226.23, 230.38, 233.58, 236.21, 239.27, 243.06, 245.1, 249.26, 252.61, 255.39, 260.13, 262.61, 264.37, 267.36, 271.09, 273.72, 277.52, 280.3, 281.26, 285.13, 287.11, 289.96, 292.97, 294.8, 296.85, 300.44, 303.59, 305.79, 308.36, 311.07, 313.71, 315.04, 316.8, 321.42, 322.38, 324.59, 327.74, 329.14, 330.24, 333.25, 334.73, 337.38, 339.58, 341.79, 343.11, 343.93, 346.57, 349.3, 350.99, 352.83, 355.12, 356.81, 358.14, 360.35, 362.12, 363.74, 365.73, 366.98, 368.54, 370.38, 370.97, 373.92, 374.59, 377.09, 377.69, 379.16, 380.2, 382.27, 383.45, 384.19, 385.88, 387.21, 388.25, 389.43, 390.32, 391.51, 392.91, 393.88, 394.9, 396.53, 397.28, 397.79, 399.72, 399.72, 400.45, 401.27, 403.05, 403.49, 404.16, 405.12, 406.01, 406.97, 406.82, 408.38, 409.04, 408.82, 409.56, 410.3, 411.12, 411.93, 412.15, 412.68, 413.12, 413.49, 414.01, 414.01, 414.82, 414.31, 414.9, 414.76, 415.34, 415.12, 415.65, 416.01, 416.3, 416.01, 416.38, 416.31, 416.09, 415.87, 415.65, 416.16, 415.79, 415.72, 415.5, 415.35, 414.98, 414.76 };

bool isApogeeed = false;

void setup() {
  Serial.begin(115200);
  while (!Serial);
  delay(3000);

  for (size_t i = 0; i < sizeof(altitudes) / sizeof(float); i++) {
    float altitude = altitudes[i];
    trajectory.update(altitude);

    // Serial.print(altitude);
    // Serial.print(",");
    // Serial.print(trajectory.climbIndex() * 50);
    // Serial.print(",");
    // Serial.println(trajectory.isFalling() * 100);

    if (trajectory.isFalling()) {
      Serial.print("APOGEE ");
      Serial.print(altitude, 2);
      Serial.println(" m");
    }

    delay(50);
  }

  Serial.println("finish");
}


void loop() {}